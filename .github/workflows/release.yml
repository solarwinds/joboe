name: Release

on:
  workflow_dispatch:
    inputs:
      checkout-ref:
        description: branch, tag or SHA to checkout. defaults to ref or SHA of triggering event.

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        test-java-version:
          - 8
          - 11
    steps:
      - uses: actions/checkout@v2.3.4
        with:
          ref: ${{ github.ref_name }}

      - id: setup-test-java
        name: Set up JDK ${{ matrix.test-java-version }} for running tests
        uses: actions/setup-java@v2
        with:
          distribution: adopt
          java-version: ${{ matrix.test-java-version }}

      - name: test
        run: mvn clean package

  release:
    needs: [ test ]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2.3.4
        with:
          ref: ${{ github.ref_name }}

      - name: Set up JDK 8
        id: setup-jdk-8
        uses: actions/setup-java@v1
        with:
          java-version: 8.0.112

      - name: Build with Maven
        run: |
          mvn -B package --file pom.xml

      - name: upload artifact
        uses: actions/upload-artifact@v2
        with:
          path: |
            core/target/core*.jar
            metrics/target/metrics*.jar
            dependencies/target/dependencies*.jar
